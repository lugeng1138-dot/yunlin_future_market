<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>雲林未來超市｜隱藏彩蛋</title>
  <meta name="description" content="掃描收據 QR 後顯示的沉浸式圖片頁" />
  <style>
    :root{
      --bg:#0b0b0f;          /* 背景底色 */
      --fg:#f4f5f7;          /* 文字主色 */
      --muted:#b6bac5;       /* 次要文字 */
      --brand:#7de2a7;       /* YCDC感綠 */
      --brand-2:#c9f27a;     /* 輔助亮綠 */
      --card:#121218;        /* 控件底色 */
      --ring: rgba(201,242,122,0.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%;}
    body{
      margin:0; background:radial-gradient(1200px circle at 80% 10%, rgba(201,242,122,.06), transparent 40%), var(--bg);
      color:var(--fg); font-family: ui-sans-serif, -apple-system, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    .frame{
      position:fixed; inset:0; display:grid; grid-template-rows:auto 1fr auto; gap:16px;
    }
    header{
      display:flex; align-items:center; justify-content:space-between; padding:16px 20px; mix-blend:normal;
    }
    .brand{display:flex; align-items:center; gap:12px; text-decoration:none; color:var(--fg)}
    .logo{
      width:36px; height:36px; border-radius:10px; background: linear-gradient(135deg, var(--brand), var(--brand-2));
      box-shadow: 0 0 0 6px var(--ring);
    }
    .brand h1{font-size:16px; margin:0; letter-spacing:.04em; font-weight:700}
    .badge{font-size:12px; padding:6px 10px; border-radius:999px; background:rgba(125,226,167,.12); color:var(--brand-2); border:1px solid rgba(125,226,167,.35)}

    /* 圖片舞台 */
    .stage{
      position:relative; display:flex; align-items:center; justify-content:center; min-height:0;
      padding:8px 12px 24px;
    }
    .canvas{
      position:relative; width:100%; height:100%; max-width:100vw; max-height:calc(100vh - 160px);
      background: radial-gradient(600px circle at 50% 50%, rgba(201,242,122,.05), transparent 60%);
      border-radius:24px; overflow:hidden; outline:1px solid rgba(255,255,255,.06);
      box-shadow: 0 10px 40px rgba(0,0,0,.35), 0 0 0 10px rgba(201,242,122,.04) inset;
      display:flex; align-items:center; justify-content:center;
      animation:pop .5s ease-out both;
    }
    @keyframes pop { from{ transform:scale(.985); opacity:0 } to{ transform:scale(1); opacity:1 } }

    img#art{ max-width:100%; max-height:100%; object-fit:contain; display:block; filter: drop-shadow(0 8px 40px rgba(0,0,0,.45)); }

    /* 下方控制列 */
    .controls{ position:sticky; bottom:0; padding:10px 16px 24px; display:flex; flex-wrap:wrap; gap:10px; justify-content:center; }
    .chip, .btn{
      border:1px solid rgba(255,255,255,.12); background:var(--card); color:var(--fg);
      padding:10px 14px; border-radius:12px; font-size:14px; line-height:1; display:inline-flex; gap:8px; align-items:center; cursor:pointer;
      transition:.18s ease; text-decoration:none;
    }
    .btn.primary{ background:linear-gradient(135deg, var(--brand), var(--brand-2)); color:#0b0b0f; border-color:transparent; font-weight:700 }
    .chip:hover,.btn:hover{ transform:translateY(-1px); box-shadow:0 8px 24px rgba(0,0,0,.25) }
    .btn:active{ transform:translateY(0) }

    footer{ text-align:center; color:var(--muted); font-size:12px; padding:0 16px 16px }
    .title{ font-weight:800; letter-spacing:.04em; display:block }
    .subtitle{ color:var(--muted) }

    /* 提示條 */
    .toast{ position:fixed; left:50%; transform:translateX(-50%); bottom:22px; padding:10px 14px; border-radius:10px; font-size:13px; background:#1b1b22; border:1px solid rgba(255,255,255,.12); display:none }
    .toast.show{ display:block; animation:fade 2.3s ease both }
    @keyframes fade{ 0%{opacity:0; transform:translate(-50%,12px)} 10%,80%{opacity:1; transform:translate(-50%,0)} 100%{opacity:0; transform:translate(-50%,-6px)} }

    /* 行動端優化 */
    @media (max-width:640px){
      header{ padding:14px 14px }
      .canvas{ border-radius:16px }
    }
  </style>
</head>
<body>
  <div class="frame" role="document">
    <header>
      <a class="brand" href="#" aria-label="YCDC">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <span class="title" id="pageTitle">雲林未來超市</span>
          <small class="subtitle" id="pageSubtitle">你已解鎖隱藏彩蛋</small>
        </div>
      </a>
      <span class="badge" id="badge">YCDC Special</span>
    </header>

    <main class="stage" aria-live="polite">
      <div class="canvas" id="canvas">
        <img id="art" alt="展覽彩蛋圖片" src="" />
      </div>
    </main>

    <div class="controls">
      <button class="btn primary" id="downloadBtn" title="下載圖片">下載圖片</button>
      <button class="chip" id="shareBtn" title="分享此頁">分享連結</button>
      <button class="chip" id="copyBtn" title="複製連結">複製連結</button>
      <a class="chip" id="backLink" href="https://ycdc.tw" target="_blank" rel="noopener">回到 YCDC 官網</a>
    </div>

    <footer>
      <small>提示：此頁可透過網址參數客製化內容（<code>?img=</code>、<code>&title=</code>、<code>&subtitle=</code>）。</small>
    </footer>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite">已複製連結</div>

  <script>
    // 讀取查詢參數
    const q = new URLSearchParams(location.search);
    const fallbackImages = [
      // 放入示意圖連結 (建議換成你方圖床/官網 CDN)
      // 例如："https://your.cdn/ycdc/egg-01.jpg",
      //      "https://your.cdn/ycdc/egg-02.jpg"
    ];

    // 支援多種指定圖片方式：
    // 1) ?img=https://... （單張）
    // 2) ?img=url1,url2,url3   （逗號分隔，隨機一張）
    // 3) ?img=random 搭配 fallbackImages
    function pickImage(){
      const imgParam = q.get('img');
      if(imgParam){
        if(imgParam === 'random'){
          if(fallbackImages.length){
            return fallbackImages[Math.floor(Math.random()*fallbackImages.length)];
          }
        } else if(imgParam.includes(',')){
          const list = imgParam.split(',').map(s=>s.trim()).filter(Boolean);
          return list[Math.floor(Math.random()*list.length)];
        } else {
          return imgParam; // 單一網址
        }
      }
      // 無參數時的預設占位圖（請換成你們的預設圖）
      return 'https://lugeng1138-dot.github.io/yunlin_future_market/DSC01887.JPG';
    }

    // 設定標題與副標
    const pageTitle = q.get('title') || '雲林未來超市';
    const pageSubtitle = q.get('subtitle') || '你已解鎖隱藏彩蛋';
    document.getElementById('pageTitle').textContent = pageTitle;
    document.getElementById('pageSubtitle').textContent = pageSubtitle;

    // 設定圖片
    const art = document.getElementById('art');
    const chosen = pickImage();
    art.src = chosen;

    // 下載按鈕：嘗試跨源抓圖，若受限 CORS 仍會觸發直接下載連結
    document.getElementById('downloadBtn').addEventListener('click', async () => {
      try{
        // 嘗試以 fetch 轉為 blob 下載（需圖源允許 CORS）
        const r = await fetch(chosen, {mode:'cors'});
        const b = await r.blob();
        const url = URL.createObjectURL(b);
        const a = document.createElement('a');
        a.href = url; a.download = (q.get('filename') || 'ycdc-egg') + (b.type && b.type.includes('png')?'.png':'.jpg');
        document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
      }catch(err){
        // 後備：直接開啟圖片，交給瀏覽器另存
        window.open(chosen, '_blank');
      }
    });

    // 分享 & 複製
    const shareBtn = document.getElementById('shareBtn');
    shareBtn.addEventListener('click', async () => {
      try{
        if(navigator.share){
          await navigator.share({ title: pageTitle, text: pageSubtitle, url: location.href });
        }else{ throw new Error('no share'); }
      }catch{
        copyToClipboard(location.href);
      }
    });

    document.getElementById('copyBtn').addEventListener('click', () => copyToClipboard(location.href));

    function copyToClipboard(text){
      navigator.clipboard.writeText(text).then(()=> showToast('已複製連結')).catch(()=> showToast('複製失敗，請手動複製'))
    }

    function showToast(msg){
      const t = document.getElementById('toast');
      t.textContent = msg; t.classList.add('show');
      setTimeout(()=> t.classList.remove('show'), 2300);
    }

    // 若想要顯示批次號/序號，可從 ?sn=xxxx 讀入並顯示在徽章
    const sn = q.get('sn');
    if(sn){ document.getElementById('badge').textContent = `Batch ${sn}`; }

    // 可選：自動滾動到圖片 (避免行動瀏覽器位移)
    window.addEventListener('load', ()=>{
      document.getElementById('canvas').scrollIntoView({behavior:'smooth', block:'center'});
    });
  </script>
</body>
</html>
